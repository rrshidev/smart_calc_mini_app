<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíº Smart Calculator</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 0 10px;
        }
        
        h1 {
            font-size: 2.2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .calc-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .calc-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        .calc-card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
            font-size: 0.95em;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            border-radius: 8px;
            font-weight: bold;
            color: #333;
            min-height: 50px;
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        .result.show {
            display: block;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .formula {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
            font-style: italic;
            line-height: 1.4;
        }
        
        .telegram-footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            padding: 20px;
            opacity: 0.8;
            font-size: 0.9em;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö Telegram */
        @media (max-width: 768px) {
            .calculator-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .calc-card {
                padding: 20px;
                margin: 0 5px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .header {
                margin-bottom: 20px;
            }
        }
        
        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è Telegram */
        .tg-theme-aware {
            background: var(--tg-theme-bg-color, linear-gradient(135deg, #667eea 0%, #764ba2 100%));
            color: var(--tg-theme-text-color, white);
        }
        
        .tg-card {
            background: var(--tg-theme-secondary-bg-color, rgba(255, 255, 255, 0.95));
            color: var(--tg-theme-text-color, #333);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíº Smart Calculator</h1>
            <div class="subtitle">–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –±–∏–∑–Ω–µ—Å-—Ä–∞—Å—á–µ—Ç—ã –≤ Telegram</div>
        </div>
        
        <div class="calculator-grid">
            <!-- 1. –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —á–∏—Å–ª–∞ -->
            <div class="calc-card">
                <h2>üìä –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —á–∏—Å–ª–∞</h2>
                <div class="input-group">
                    <label>–ß–∏—Å–ª–æ:</label>
                    <input type="number" id="percentBase1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 100">
                </div>
                <div class="input-group">
                    <label>–ü—Ä–æ—Ü–µ–Ω—Ç (%):</label>
                    <input type="number" id="percentValue1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 15">
                </div>
                <button class="btn" onclick="calculatePercentOf()">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
                <div class="result" id="result1"></div>
            </div>
            
            <!-- 2. –°–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç —á–∏—Å–ª–æ -->
            <div class="calc-card">
                <h2>üî¢ –°–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç</h2>
                <div class="input-group">
                    <label>–ß–∞—Å—Ç—å (—á–∏—Å–ª–æ):</label>
                    <input type="number" id="partNumber" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 25">
                </div>
                <div class="input-group">
                    <label>–¶–µ–ª–æ–µ (–æ—Ç —á–∏—Å–ª–∞):</label>
                    <input type="number" id="wholeNumber" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 200">
                </div>
                <button class="btn" onclick="calculateWhatPercent()">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
                <div class="result" id="result2"></div>
            </div>
            
            <!-- 3. –ü—Ä–∏–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç -->
            <div class="calc-card">
                <h2>‚ûï –ü—Ä–∏–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç –∫ —á–∏—Å–ª—É</h2>
                <div class="input-group">
                    <label>–ò—Å—Ö–æ–¥–Ω–æ–µ —á–∏—Å–ª–æ:</label>
                    <input type="number" id="baseNumber3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1000">
                </div>
                <div class="input-group">
                    <label>–ü—Ä–æ—Ü–µ–Ω—Ç (%):</label>
                    <input type="number" id="percentToAdd" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 20">
                </div>
                <button class="btn" onclick="calculateAddPercent()">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
                <div class="result" id="result3"></div>
            </div>
            
            <!-- 4. –ù–∞—Ü–µ–Ω–∫–∞ –∏ –ú–∞—Ä–∂–∞ -->
            <div class="calc-card">
                <h2>üí∞ –ù–∞—Ü–µ–Ω–∫–∞ –∏ –ú–∞—Ä–∂–∞</h2>
                <div class="input-group">
                    <label>–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å:</label>
                    <input type="number" id="costPrice" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 800">
                </div>
                <div class="input-group">
                    <label>–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏:</label>
                    <input type="number" id="sellingPrice" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1200">
                </div>
                <button class="btn" onclick="calculateMargin()">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
                <div class="result" id="result4"></div>
            </div>
            
            <!-- 5. –ù–î–° -->
            <div class="calc-card">
                <h2>üìë –†–∞—Å—á—ë—Ç –ù–î–°</h2>
                <div class="input-group">
                    <label>–°—É–º–º–∞ –±–µ–∑ –ù–î–°:</label>
                    <input type="number" id="amountWithoutVAT" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 10000">
                </div>
                <div class="input-group">
                    <label>–°—Ç–∞–≤–∫–∞ –ù–î–° (%):</label>
                    <input type="number" id="vatRate" value="20" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 20">
                </div>
                <button class="btn" onclick="calculateVAT()">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
                <div class="result" id="result5"></div>
            </div>
            
            <!-- 6. –í—ã–¥–µ–ª–∏—Ç—å –ù–î–° -->
            <div class="calc-card">
                <h2>üì§ –í—ã–¥–µ–ª–∏—Ç—å –ù–î–° –∏–∑ —Å—É–º–º—ã</h2>
                <div class="input-group">
                    <label>–°—É–º–º–∞ —Å –ù–î–°:</label>
                    <input type="number" id="amountWithVAT" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 12000">
                </div>
                <div class="input-group">
                    <label>–°—Ç–∞–≤–∫–∞ –ù–î–° (%):</label>
                    <input type="number" id="vatRate2" value="20" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 20">
                </div>
                <button class="btn" onclick="extractVAT()">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
                <div class="result" id="result6"></div>
            </div>
            
            <!-- 7. –°–∫–∏–¥–∫–∞ -->
            <div class="calc-card">
                <h2>üéØ –†–∞—Å—á—ë—Ç —Å–∫–∏–¥–∫–∏</h2>
                <div class="input-group">
                    <label>–ò—Å—Ö–æ–¥–Ω–∞—è —Ü–µ–Ω–∞:</label>
                    <input type="number" id="originalPrice" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 5000">
                </div>
                <div class="input-group">
                    <label>–°–∫–∏–¥–∫–∞ (%):</label>
                    <input type="number" id="discountPercent" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 15">
                </div>
                <button class="btn" onclick="calculateDiscount()">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
                <div class="result" id="result7"></div>
            </div>
            
            <!-- 8. –ó–∞—Ä–ø–ª–∞—Ç–∞ (–ß–∏—Å—Ç–∞—è –∏ –ì—Ä—è–∑–Ω–∞—è) -->
            <div class="calc-card">
                <h2>üíµ –ó–∞—Ä–ø–ª–∞—Ç–∞ (—Å –ù–î–§–õ)</h2>
                <div class="input-group">
                    <label>–ó–∞—Ä–ø–ª–∞—Ç–∞ (–¥–æ –≤—ã—á–µ—Ç–∞ –ù–î–§–õ):</label>
                    <input type="number" id="grossSalary" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 100000">
                </div>
                <div class="input-group">
                    <label>–°—Ç–∞–≤–∫–∞ –ù–î–§–õ (%):</label>
                    <input type="number" id="taxRate" value="13" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 13">
                </div>
                <button class="btn" onclick="calculateNetSalary()">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
                <div class="result" id="result8"></div>
            </div>
            
            <!-- 9. ROI (–û–∫—É–ø–∞–µ–º–æ—Å—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π) -->
            <div class="calc-card">
                <h2>üìà ROI (–û–∫—É–ø–∞–µ–º–æ—Å—Ç—å)</h2>
                <div class="input-group">
                    <label>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏:</label>
                    <input type="number" id="investment" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 50000">
                </div>
                <div class="input-group">
                    <label>–î–æ—Ö–æ–¥ (–ø—Ä–∏–±—ã–ª—å):</label>
                    <input type="number" id="profit" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 75000">
                </div>
                <button class="btn" onclick="calculateROI()">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
                <div class="result" id="result9"></div>
            </div>
            
            <!-- 10. –ü—Ä–æ—Ü–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è -->
            <div class="calc-card">
                <h2>üìä –ü—Ä–æ—Ü–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è</h2>
                <div class="input-group">
                    <label>–ù–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:</label>
                    <input type="number" id="initialValue" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1000">
                </div>
                <div class="input-group">
                    <label>–ö–æ–Ω–µ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:</label>
                    <input type="number" id="finalValue" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1250">
                </div>
                <button class="btn" onclick="calculatePercentChange()">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
                <div class="result" id="result10"></div>
            </div>
            
            <!-- 11. –°—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞ -->
            <div class="calc-card">
                <h2>‚öñÔ∏è –°—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞</h2>
                <div class="input-group">
                    <label>–¶–µ–Ω–∞ 1:</label>
                    <input type="number" id="price1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 100">
                </div>
                <div class="input-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ 1:</label>
                    <input type="number" id="qty1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 5">
                </div>
                <div class="input-group">
                    <label>–¶–µ–Ω–∞ 2:</label>
                    <input type="number" id="price2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 120">
                </div>
                <div class="input-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ 2:</label>
                    <input type="number" id="qty2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 3">
                </div>
                <button class="btn" onclick="calculateWeightedAverage()">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
                <div class="result" id="result11"></div>
            </div>
            
            <!-- 12. –ö—Ä–µ–¥–∏—Ç (–ê–Ω–Ω—É–∏—Ç–µ—Ç–Ω—ã–π –ø–ª–∞—Ç—ë–∂) -->
            <div class="calc-card">
                <h2>üè¶ –ê–Ω–Ω—É–∏—Ç–µ—Ç–Ω—ã–π –ø–ª–∞—Ç—ë–∂ –ø–æ –∫—Ä–µ–¥–∏—Ç—É</h2>
                <div class="input-group">
                    <label>–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞:</label>
                    <input type="number" id="loanAmount" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1000000">
                </div>
                <div class="input-group">
                    <label>–°—Ç–∞–≤–∫–∞ % (–≥–æ–¥–æ–≤—ã—Ö):</label>
                    <input type="number" id="interestRate" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 12">
                </div>
                <div class="input-group">
                    <label>–°—Ä–æ–∫ (–º–µ—Å—è—Ü–µ–≤):</label>
                    <input type="number" id="loanTerm" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 24">
                </div>
                <button class="btn" onclick="calculateLoanPayment()">–í—ã—á–∏—Å–ª–∏—Ç—å</button>
                <div class="result" id="result12"></div>
            </div>
        </div>
        
        <div class="telegram-footer">
            <div>üöÄ –†–∞–±–æ—Ç–∞–µ—Ç –≤ Telegram ‚Ä¢ v1.0</div>
            <div style="font-size: 0.8em; margin-top: 5px; opacity: 0.6;">sa32.ru/smart_calc</div>
        </div>
    </div>
    
    <script>
        // ================= TELEGRAM WEB APP INITIALIZATION =================
        let tg = null;
        let isTelegram = false;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ –≤ Telegram
        if (window.Telegram && window.Telegram.WebApp) {
            tg = window.Telegram.WebApp;
            isTelegram = true;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
            tg.ready();
            tg.expand(); // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
            tg.enableClosingConfirmation(); // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è
            
            // –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º —Å—Ç–∏–ª–∏ –ø–æ–¥ —Ç–µ–º—É Telegram
            applyTelegramTheme();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            tg.MainButton.setText('üìä –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º');
            tg.MainButton.hide();
            
            console.log('‚úÖ Telegram Web App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            console.log('User:', tg.initDataUnsafe?.user);
            console.log('Theme:', tg.themeParams);
        } else {
            console.log('‚ÑπÔ∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –≤–Ω–µ Telegram');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã Telegram
        function applyTelegramTheme() {
            if (!isTelegram) return;
            
            const theme = tg.themeParams;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç–∞ —Ç–µ–º—ã Telegram
            document.body.style.backgroundColor = theme.bg_color || '#667eea';
            document.body.style.color = theme.text_color || '#ffffff';
            
            // –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–¥ —Ç–µ–º—É
            const cards = document.querySelectorAll('.calc-card');
            cards.forEach(card => {
                card.style.backgroundColor = theme.secondary_bg_color || 'rgba(255, 255, 255, 0.95)';
                card.style.color = theme.text_color || '#333';
            });
            
            // –ê–¥–∞–ø—Ç–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
            const headers = document.querySelectorAll('.header, .telegram-footer');
            headers.forEach(header => {
                header.style.color = theme.text_color || '#ffffff';
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Telegram
        function shareToTelegram(resultText) {
            if (!isTelegram) {
                // –ï—Å–ª–∏ –Ω–µ –≤ Telegram, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—ã–π alert
                alert(resultText);
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            tg.MainButton.setText('üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —á–∞—Ç');
            tg.MainButton.show();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ
            tg.MainButton.onClick(() => {
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –≤ —á–∞—Ç
                tg.showPopup({
                    title: '–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω',
                    message: '–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —á–∞—Ç',
                    buttons: [{ type: 'ok' }]
                });
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
                tg.MainButton.hide();
            });
        }
        
        // ================= CALCULATION FUNCTIONS =================
        
        // 1. –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —á–∏—Å–ª–∞
        function calculatePercentOf() {
            const base = parseFloat(document.getElementById('percentBase1').value);
            const percent = parseFloat(document.getElementById('percentValue1').value);
            const result = document.getElementById('result1');
            
            if (isNaN(base) || isNaN(percent)) {
                result.innerHTML = '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–∞';
                result.classList.add('show');
                return;
            }
            
            const answer = (base * percent) / 100;
            const resultText = `${percent}% –æ—Ç ${base} = ${answer.toFixed(2)}`;
            
            result.innerHTML = `
                <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${answer.toFixed(2)}</strong><br>
                <span class="formula">${percent}% –æ—Ç ${base} = ${answer.toFixed(2)}</span>
            `;
            result.classList.add('show');
            
            shareToTelegram(resultText);
        }
        
        // 2. –°–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç
        function calculateWhatPercent() {
            const part = parseFloat(document.getElementById('partNumber').value);
            const whole = parseFloat(document.getElementById('wholeNumber').value);
            const result = document.getElementById('result2');
            
            if (isNaN(part) || isNaN(whole) || whole === 0) {
                result.innerHTML = '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–∞ (—Ü–µ–ª–æ–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å 0)';
                result.classList.add('show');
                return;
            }
            
            const answer = (part / whole) * 100;
            const resultText = `${part} —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ${answer.toFixed(2)}% –æ—Ç ${whole}`;
            
            result.innerHTML = `
                <strong>–†–µ–∑—É–ª—å—Ç–∞—Ç: ${answer.toFixed(2)}%</strong><br>
                <span class="formula">${part} —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç ${answer.toFixed(2)}% –æ—Ç ${whole}</span>
            `;
            result.classList.add('show');
            
            shareToTelegram(resultText);
        }
        
        // 3. –ü—Ä–∏–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        function calculateAddPercent() {
            const base = parseFloat(document.getElementById('baseNumber3').value);
            const percent = parseFloat(document.getElementById('percentToAdd').value);
            const result = document.getElementById('result3');
            
            if (isNaN(base) || isNaN(percent)) {
                result.innerHTML = '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–∞';
                result.classList.add('show');
                return;
            }
            
            // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞: –Ω–æ–≤–æ–µ_–∑–Ω–∞—á–µ–Ω–∏–µ = –∏—Å—Ö–æ–¥–Ω–æ–µ + (–∏—Å—Ö–æ–¥–Ω–æ–µ √ó –ø—Ä–æ—Ü–µ–Ω—Ç / 100)
            const increase = (base * percent) / 100;
            const newValue = base + increase;
            
            const resultText = `${base} + ${percent}% = ${newValue.toFixed(2)} (–ø—Ä–∏–±–∞–≤–∫–∞: ${increase.toFixed(2)})`;
            
            result.innerHTML = `
                <strong>–ù–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${newValue.toFixed(2)}</strong><br>
                <strong>–ü—Ä–∏–±–∞–≤–∫–∞: ${increase.toFixed(2)}</strong><br>
                <span class="formula">${base} + ${percent}% = ${newValue.toFixed(2)}</span>
            `;
            result.classList.add('show');
            
            shareToTelegram(resultText);
        }
        
        // 4. –ù–∞—Ü–µ–Ω–∫–∞ –∏ –ú–∞—Ä–∂–∞
        function calculateMargin() {
            const cost = parseFloat(document.getElementById('costPrice').value);
            const selling = parseFloat(document.getElementById('sellingPrice').value);
            const result = document.getElementById('result4');
            
            if (isNaN(cost) || isNaN(selling) || cost === 0) {
                result.innerHTML = '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–∞';
                result.classList.add('show');
                return;
            }
            
            const profit = selling - cost;
            const markup = (profit / cost) * 100;
            const margin = (profit / selling) * 100;
            
            const resultText = `–ü—Ä–∏–±—ã–ª—å: ${profit.toFixed(2)} | –ù–∞—Ü–µ–Ω–∫–∞: ${markup.toFixed(2)}% | –ú–∞—Ä–∂–∞: ${margin.toFixed(2)}%`;
            
            result.innerHTML = `
                <strong>–ü—Ä–∏–±—ã–ª—å: ${profit.toFixed(2)}</strong><br>
                <strong>–ù–∞—Ü–µ–Ω–∫–∞: ${markup.toFixed(2)}%</strong><br>
                <strong>–ú–∞—Ä–∂–∞: ${margin.toFixed(2)}%</strong><br>
                <span class="formula">
                    –ù–∞—Ü–µ–Ω–∫–∞ = (–ü—Ä–∏–±—ã–ª—å / –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å) √ó 100<br>
                    –ú–∞—Ä–∂–∞ = (–ü—Ä–∏–±—ã–ª—å / –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏) √ó 100
                </span>
            `;
            result.classList.add('show');
            
            shareToTelegram(resultText);
        }
        
        // 5. –ù–î–°
        function calculateVAT() {
            const amount = parseFloat(document.getElementById('amountWithoutVAT').value);
            const rate = parseFloat(document.getElementById('vatRate').value);
            const result = document.getElementById('result5');
            
            if (isNaN(amount) || isNaN(rate)) {
                result.innerHTML = '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–∞';
                result.classList.add('show');
                return;
            }
            
            const vat = (amount * rate) / 100;
            const total = amount + vat;
            
            const resultText = `–°—É–º–º–∞ —Å –ù–î–°: ${total.toFixed(2)} (–ù–î–°: ${vat.toFixed(2)})`;
            
            result.innerHTML = `
                <strong>–ù–î–°: ${vat.toFixed(2)}</strong><br>
                <strong>–°—É–º–º–∞ —Å –ù–î–°: ${total.toFixed(2)}</strong><br>
                <span class="formula">${amount} + ${rate}% –ù–î–° = ${total.toFixed(2)}</span>
            `;
            result.classList.add('show');
            
            shareToTelegram(resultText);
        }
        
        // 6. –í—ã–¥–µ–ª–∏—Ç—å –ù–î–°
        function extractVAT() {
            const total = parseFloat(document.getElementById('amountWithVAT').value);
            const rate = parseFloat(document.getElementById('vatRate2').value);
            const result = document.getElementById('result6');
            
            if (isNaN(total) || isNaN(rate)) {
                result.innerHTML = '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–∞';
                result.classList.add('show');
                return;
            }
            
            const vat = total - (total / (1 + rate / 100));
            const amountWithoutVAT = total - vat;
            
            const resultText = `–°—É–º–º–∞ –±–µ–∑ –ù–î–°: ${amountWithoutVAT.toFixed(2)} (–ù–î–°: ${vat.toFixed(2)})`;
            
            result.innerHTML = `
                <strong>–°—É–º–º–∞ –±–µ–∑ –ù–î–°: ${amountWithoutVAT.toFixed(2)}</strong><br>
                <strong>–ù–î–°: ${vat.toFixed(2)}</strong><br>
                <span class="formula">–ù–î–° –≤—ã–¥–µ–ª–µ–Ω –∏–∑ —Å—É–º–º—ã ${total}</span>
            `;
            result.classList.add('show');
            
            shareToTelegram(resultText);
        }
        
        // 7. –°–∫–∏–¥–∫–∞
        function calculateDiscount() {
            const price = parseFloat(document.getElementById('originalPrice').value);
            const discount = parseFloat(document.getElementById('discountPercent').value);
            const result = document.getElementById('result7');
            
            if (isNaN(price) || isNaN(discount)) {
                result.innerHTML = '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–∞';
                result.classList.add('show');
                return;
            }
            
            const discountAmount = (price * discount) / 100;
            const finalPrice = price - discountAmount;
            
            const resultText = `–¶–µ–Ω–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π: ${finalPrice.toFixed(2)} (—Å–∫–∏–¥–∫–∞: ${discountAmount.toFixed(2)})`;
            
            result.innerHTML = `
                <strong>–°–∫–∏–¥–∫–∞: ${discountAmount.toFixed(2)}</strong><br>
                <strong>–¶–µ–Ω–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π: ${finalPrice.toFixed(2)}</strong><br>
                <span class="formula">–≠–∫–æ–Ω–æ–º–∏—è ${discount}%</span>
            `;
            result.classList.add('show');
            
            shareToTelegram(resultText);
        }
        
        // 8. –ó–∞—Ä–ø–ª–∞—Ç–∞
        function calculateNetSalary() {
            const gross = parseFloat(document.getElementById('grossSalary').value);
            const tax = parseFloat(document.getElementById('taxRate').value);
            const result = document.getElementById('result8');
            
            if (isNaN(gross) || isNaN(tax)) {
                result.innerHTML = '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–∞';
                result.classList.add('show');
                return;
            }
            
            const taxAmount = (gross * tax) / 100;
            const netSalary = gross - taxAmount;
            
            const resultText = `–ó–∞—Ä–ø–ª–∞—Ç–∞ –Ω–∞ —Ä—É–∫–∏: ${netSalary.toFixed(2)} (–ù–î–§–õ: ${taxAmount.toFixed(2)})`;
            
            result.innerHTML = `
                <strong>–ù–î–§–õ: ${taxAmount.toFixed(2)}</strong><br>
                <strong>–ù–∞ —Ä—É–∫–∏: ${netSalary.toFixed(2)}</strong><br>
                <span class="formula">–ó–∞—Ä–ø–ª–∞—Ç–∞ –ø–æ—Å–ª–µ –≤—ã—á–µ—Ç–∞ ${tax}% –ù–î–§–õ</span>
            `;
            result.classList.add('show');
            
            shareToTelegram(resultText);
        }
        
        // 9. ROI
        function calculateROI() {
            const investment = parseFloat(document.getElementById('investment').value);
            const profit = parseFloat(document.getElementById('profit').value);
            const result = document.getElementById('result9');
            
            if (isNaN(investment) || isNaN(profit) || investment === 0) {
                result.innerHTML = '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–∞';
                result.classList.add('show');
                return;
            }
            
            const netProfit = profit - investment;
            const roi = (netProfit / investment) * 100;
            
            const resultText = `ROI: ${roi.toFixed(2)}% (–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å: ${netProfit.toFixed(2)})`;
            
            result.innerHTML = `
                <strong>–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å: ${netProfit.toFixed(2)}</strong><br>
                <strong>ROI: ${roi.toFixed(2)}%</strong><br>
                <span class="formula">
                    ${roi > 0 ? '‚úÖ –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –æ–∫—É–ø–∏–ª–∞—Å—å' : '‚ùå –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è –Ω–µ –æ–∫—É–ø–∏–ª–∞—Å—å'}
                </span>
            `;
            result.classList.add('show');
            
            shareToTelegram(resultText);
        }
        
        // 10. –ü—Ä–æ—Ü–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
        function calculatePercentChange() {
            const initial = parseFloat(document.getElementById('initialValue').value);
            const final = parseFloat(document.getElementById('finalValue').value);
            const result = document.getElementById('result10');
            
            if (isNaN(initial) || isNaN(final) || initial === 0) {
                result.innerHTML = '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–∞';
                result.classList.add('show');
                return;
            }
            
            const change = final - initial;
            const percentChange = (change / initial) * 100;
            const sign = percentChange > 0 ? '+' : '';
            
            const resultText = `–ò–∑–º–µ–Ω–µ–Ω–∏–µ: ${sign}${percentChange.toFixed(2)}% (${sign}${change.toFixed(2)})`;
            
            result.innerHTML = `
                <strong>–ò–∑–º–µ–Ω–µ–Ω–∏–µ: ${sign}${change.toFixed(2)}</strong><br>
                <strong>–ü—Ä–æ—Ü–µ–Ω—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è: ${sign}${percentChange.toFixed(2)}%</strong><br>
                <span class="formula">
                    ${percentChange > 0 ? 'üìà –†–æ—Å—Ç' : 'üìâ –°–Ω–∏–∂–µ–Ω–∏–µ'}
                </span>
            `;
            result.classList.add('show');
            
            shareToTelegram(resultText);
        }
        
        // 11. –°—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞
        function calculateWeightedAverage() {
            const p1 = parseFloat(document.getElementById('price1').value);
            const q1 = parseFloat(document.getElementById('qty1').value);
            const p2 = parseFloat(document.getElementById('price2').value);
            const q2 = parseFloat(document.getElementById('qty2').value);
            const result = document.getElementById('result11');
            
            if (isNaN(p1) || isNaN(q1) || isNaN(p2) || isNaN(q2)) {
                result.innerHTML = '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–∞';
                result.classList.add('show');
                return;
            }
            
            const totalQty = q1 + q2;
            if (totalQty === 0) {
                result.innerHTML = '‚ùå –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å 0';
                result.classList.add('show');
                return;
            }
            
            const weightedAvg = ((p1 * q1) + (p2 * q2)) / totalQty;
            const totalCost = (p1 * q1) + (p2 * q2);
            
            const resultText = `–°—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞: ${weightedAvg.toFixed(2)} (–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${totalCost.toFixed(2)})`;
            
            result.innerHTML = `
                <strong>–°—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Ü–µ–Ω–∞: ${weightedAvg.toFixed(2)}</strong><br>
                <strong>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ${totalCost.toFixed(2)}</strong><br>
                <strong>–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${totalQty}</strong><br>
                <span class="formula">
                    (${p1} √ó ${q1} + ${p2} √ó ${q2}) / ${totalQty}
                </span>
            `;
            result.classList.add('show');
            
            shareToTelegram(resultText);
        }
        
        // 12. –ö—Ä–µ–¥–∏—Ç (–ê–Ω–Ω—É–∏—Ç–µ—Ç–Ω—ã–π –ø–ª–∞—Ç—ë–∂)
        function calculateLoanPayment() {
            const loan = parseFloat(document.getElementById('loanAmount').value);
            const rate = parseFloat(document.getElementById('interestRate').value);
            const term = parseFloat(document.getElementById('loanTerm').value);
            const result = document.getElementById('result12');
            
            if (isNaN(loan) || isNaN(rate) || isNaN(term) || term === 0) {
                result.innerHTML = '‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —á–∏—Å–ª–∞';
                result.classList.add('show');
                return;
            }
            
            const monthlyRate = (rate / 100) / 12;
            const payment = loan * (monthlyRate * Math.pow(1 + monthlyRate, term)) / (Math.pow(1 + monthlyRate, term) - 1);
            const totalPayment = payment * term;
            const overpayment = totalPayment - loan;
            
            const resultText = `–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂: ${payment.toFixed(2)} | –û–±—â–∞—è –≤—ã–ø–ª–∞—Ç–∞: ${totalPayment.toFixed(2)} | –ü–µ—Ä–µ–ø–ª–∞—Ç–∞: ${overpayment.toFixed(2)}`;
            
            result.innerHTML = `
                <strong>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –ø–ª–∞—Ç—ë–∂: ${payment.toFixed(2)}</strong><br>
                <strong>–û–±—â–∞—è –≤—ã–ø–ª–∞—Ç–∞: ${totalPayment.toFixed(2)}</strong><br>
                <strong>–ü–µ—Ä–µ–ø–ª–∞—Ç–∞: ${overpayment.toFixed(2)}</strong><br>
                <span class="formula">
                    –°—Ä–æ–∫: ${term} –º–µ—Å., —Å—Ç–∞–≤–∫–∞ ${rate}% –≥–æ–¥–æ–≤—ã—Ö
                </span>
            `;
            result.classList.add('show');
            
            shareToTelegram(resultText);
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–≤–æ–¥–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è UX
        document.addEventListener('DOMContentLoaded', function() {
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ –≤—Å–µ input'—ã –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    // –ù–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ —Å–∫—Ä—ã–≤–∞–µ–º –µ–≥–æ
                    const card = this.closest('.calc-card');
                    const result = card.querySelector('.result');
                    if (result) {
                        result.classList.remove('show');
                        // –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É Telegram –µ—Å–ª–∏ –æ–Ω–∞ –≤–∏–¥–Ω–∞
                        if (isTelegram) {
                            tg.MainButton.hide();
                        }
                    }
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–∞ –ø–æ Enter
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const card = this.closest('.calc-card');
                        const button = card.querySelector('.btn');
                        if (button) {
                            button.click();
                        }
                    }
                });
            });
            
            console.log('üöÄ Smart Calculator –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!');
        });
    </script>
</body>
</html>